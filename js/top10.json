{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

  "width": 1000,
  "height": 420,
  "autosize": { "type": "fit", "contains": "padding" },

  "data": { "url": "data/top10vis.csv" },

  "transform": [
    {
      "fold": ["Aug-23", "Aug-24", "Aug-25"],
      "as": ["DateStr", "ArrivalsRaw"]
    },
    { "calculate": "utcParse(datum.DateStr, '%b-%y')", "as": "t" },
    { "calculate": "toNumber(replace(datum.ArrivalsRaw, /,/g, ''))/1e3", "as": "Thousands" },
    { "filter": "isValid(datum.t) && isFinite(datum.Thousands)" }
  ],

  "layer": [
    {
      "mark": { "type": "line", 
                "interpolate": "monotone", 
                "strokeWidth": 2.5 },

      "encoding": {
        "x": {
          "field": "t",
          "type": "temporal",
          "scale": {
            "domain": [
              { "year": 2023, "month": 8 },    
              { "year": 2025, "month": 8 }    
            ]
          },
          "axis": { "format": "%b %Y", "title": "", "values": [
            { "year": 2023, "month": "Aug" },
            { "year": 2024, "month": "Aug" },
            { "year": 2025, "month": "Aug" }
          ], "grid": false}
        },
        "y": {
          "field": "Thousands",
          "type": "quantitative",
          "title": "Thousands"
        },
        "color": {
          "field": "Country of Residence",
          "type": "nominal",
          "title": null
        },
        "tooltip": [
          { "field": "t", "type": "temporal", "title": "Date", "format": "%b %Y" },
          { "field": "Country of Residence", "type": "nominal", "title": "Country" },
          { "field": "Thousands", "type": "quantitative", "title": "", "format": ".2f" }
        ]
      }
    },
    {
      "data": {
        "values": [
          { "date": "Apr-24", "y": 99 }
        ]
      },
      "transform": [
        { "calculate": "utcParse(datum.date, '%b-%y')", "as": "t" }
      ],
      "mark": {
        "type": "rect",
        "fill": "white",
        "opacity": 0.7,
        "cornerRadius": 4,
        "dx": 5,
        "width": 240,
        "height": 50
      },
      "encoding": {
        "x": { "field": "t", "type": "temporal" },
        "y": { "field": "y", "type": "quantitative" }
      }
    },
    {
      "data": {
        "values": [
          { "date": "Jan-24", "y": 100, "text": "China shows the strongest growth,\nincreasing from 60k to nearly 100k visitors." }
        ]
      },
      "transform": [
        { "calculate": "utcParse(datum.date, '%b-%y')", "as": "t" }
      ],
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "middle",
        "dx": 5,
        "fontSize": 11,
        "lineBreak": "\n"
      },
      "encoding": {
        "x": { "field": "t", "type": "temporal" },
        "y": { "field": "y", "type": "quantitative" },
        "text": { "field": "text", "type": "nominal" }
      }
    }
  ],

  "config": {
    "background": "#eaf5ffff",
    "axis": { "labelFont": "Open Sans, sans-serif"}
  }
}