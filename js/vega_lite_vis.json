{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  
  "params": [
    {
      "name": "Region_selection",
      "value": null,
      "bind": {
        "input": "select",
        "element": "#region-select",  
        "options": [null, "Sydney", "Melbourne"],
        "labels": ["Show All", "Sydney", "Melbourne"]
      }
    }
  ],

  "vconcat": [
    {
      "width": 800,
      "height": 500,
      "title": {"text": "Number of trips per city (1998 - 2016)","fontSize": 18},      
      "projection": { "type": "equirectangular", "center": [133, -10], "scale": 900 },

      "layer": [
        {
          "data": {
            "url": "ne_110m.json",
            "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
          },
          "mark": { "type": "geoshape", "fill": "#cececeff" }
        },
        {
          "data": {
            "url": "ne_110m.json",
            "format": { "type": "topojson", "feature": "ne_110m_graticules_30" }
          },
          "mark": { "type": "geoshape", "fill": null, "stroke": "#9f9f9fff" }
        },
        {
          "data": { "url": "data/tourism.csv" },
          "transform": [
            { "aggregate": [{ "op": "sum", "field": "Trips", "as": "sum_Trips" }], "groupby": ["Region"] },
            {
              "lookup": "Region",
              "from": {
                "data": { "url": "data/worldcities_au.csv" },
                "key": "city",
                "fields": ["lat", "lng", "country"]
              },
              "as": ["lat", "lon", "country"]
            },
            { "filter": "Region_selection == null || datum.Region == Region_selection" }
          ],
          "mark": { "type": "circle", "opacity": 0.9, "tooltip": true },
          "encoding": {
            "longitude": { "field": "lon", "type": "quantitative" },
            "latitude":  { "field": "lat", "type": "quantitative" },
            "size": {
              "field": "sum_Trips",
              "type": "quantitative",
              "title": "Trips",
              "scale": { "range": [30, 4000] }
            },
            "tooltip": [
              { "field": "Region", "type": "nominal", "title": "City" },
              { "field": "sum_Trips", "type": "quantitative", "title": "Trips" }
            ]
          }
        },
        {
          "data": { "url": "data/tourism.csv" },
          "transform": [
            { "aggregate": [{ "op": "sum", "field": "Trips", "as": "sum_Trips" }], "groupby": ["Region"] },
            {
              "lookup": "Region",
              "from": {
                "data": { "url": "data/worldcities_au.csv" },
                "key": "city",
                "fields": ["lat", "lng", "country"]
              },
              "as": ["lat", "lon", "country"]
            },
            { "filter": "Region_selection == null || datum.Region == Region_selection" }
          ],
          "mark": { "type": "text", "dx": 8, "dy": -8, "fontSize": 12, "fontStyle": "italic" },
          "encoding": {
            "longitude": { "field": "lon", "type": "quantitative" },
            "latitude":  { "field": "lat", "type": "quantitative" },
            "text": { "field": "Region" },
            "color": { "value": "black" },
            "opacity": {
              "condition": [
                { "test": "Region_selection != null && datum.Region == Region_selection", "value": 1 },
                { "test": "Region_selection == null && (datum.Region == 'Sydney' || datum.Region == 'Melbourne')", "value": 1 }
              ],
              "value": 0
            }
          }
        }
      ]
    },







{
  "title": {"text": "Overseas Arrivals and Departures (Monthly)","fontSize": 18},
  "width": 800,
  "height": 500,
  "data": { "url": "data/arrivalsDepartures.csv" },
  "transform": [
    { "fold": ["Arrivals (M)", "Departures (M)"], "as": ["SeriesRaw", "value"] },

    { "calculate": "datum.SeriesRaw == 'Arrivals (M)' ? 'Arrivals' : 'Departures'", "as": "Series" },

    { "calculate": "toNumber(datum.value)", "as": "millions" },

    { "calculate": "utcParse(datum.date, '%b-%y')", "as": "t" },

    { "filter": "isValid(datum.t) && isFinite(datum.millions)" }
  ],
  "layer": [
    {
      "mark": { "type": "line", "interpolate": "monotone", "strokeWidth": 2 },
      "encoding": {
        "x": { "field": "t", "type": "temporal", "title": "", "axis": { "format": "%b %Y", "labelOverlap": true } },
        "y": { "field": "millions", "type": "quantitative", "title": "Millions" },
        "color": { "field": "Series", "type": "nominal", "title": null },
        "tooltip": [
          { "field": "t", "type": "temporal", "title": "Month", "format": "%b %Y" },
          { "field": "Series", "type": "nominal" },
          { "field": "millions", "type": "quantitative", "title": "Value (Millions)", "format": ".2f" }
        ]
      }
    },
    {
      "mark": { "type": "circle", "opacity": 1, "size": 0 },
      "encoding": {
        "color": { "field": "Series", "type": "nominal" ,"legend": { "orient": "bottom" }}
      }
    }
  ]
}

  ],

  "config": {
    "background": "#eaf5ffff",
    "legend": { "orient": "right" ,"labelFontSize": 13, "labelColor" : "eaf5ffff", "titleFontSize": 12},
    "axis": { "labelFont": "sans-serif", "titleFont": "sans-serif" }
  }
}
