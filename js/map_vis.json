{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

  "params": [
    {
      "name": "Region_selection",
      "value": null,
      "bind": {
        "input": "select",
        "element": "#region-select",
        "options": [null, "Sydney", "Melbourne"],
        "labels": ["Show All", "Sydney", "Melbourne"]
      }
    }
  ],

  "width": "container",
    "height": 600,
  "autosize": { "type": "fit", "contains": "padding" },
  "projection": { "type": "equirectangular", "center": [133, -27], "scale": 900 },

  "layer": [
    {
      "data": {
        "url": "ne_110m.json",
        "format": { "type": "topojson", 
                    "feature": "ne_110m_admin_0_countries" }
      },
      "mark": { "type": "geoshape", 
                "fill": "#337d16be" }
    },
    {
      "data": {
        "url": "ne_110m.json",
        "format": { "type": "topojson", 
                    "feature": "ne_110m_graticules_30" }
      },
      "mark": { "type": "geoshape", 
                "fill": null, 
                "stroke": "#4e4e4e" }
    },
    {
      "data": { "url": "data/tourism.csv" },
      "transform": [
        { "aggregate": [{ "op": "sum", 
                            "field": "Trips", 
                            "as": "sum_Trips" }], 
                            "groupby": ["Region"] },
        {
          "lookup": "Region",
          "from": {
            "data": { "url": "data/worldcities_au.csv" },
            "key": "city",
            "fields": ["lat", "lng", "country"]
          },
          "as": ["lat", "lon", "country"]
        },
        { "filter": "Region_selection == null || datum.Region == Region_selection" }
      ],
      "mark": { "type": "circle", "opacity": 0.9, "tooltip": true},
      "encoding": {
        "longitude": { "field": "lon", "type": "quantitative" },
        "latitude":  { "field": "lat", "type": "quantitative" },
        "size": {
          "field": "sum_Trips",
          "type": "quantitative",
          "title": "Trips",
          "scale": { "range": [30, 4000] }
        },
        "color": {
            "field": "sum_Trips",     
            "type": "nominal",
            "scale": { "scheme": "category20" },
            "legend": null
        },
        "tooltip": [
          { "field": "Region", "type": "nominal", "title": "City" },
          { "field": "sum_Trips", "type": "quantitative", "title": "Trips" }
        ]
      }
    },
    {
      "data": { "url": "data/tourism.csv" },
      "transform": [
        { "aggregate": [{ "op": "sum", "field": "Trips", "as": "sum_Trips" }], "groupby": ["Region"] },
        {
          "lookup": "Region",
          "from": {
            "data": { "url": "data/worldcities_au.csv" },
            "key": "city",
            "fields": ["lat", "lng", "country"]
          },
          "as": ["lat", "lon", "country"]
        },
        { "filter": "Region_selection == null || datum.Region == Region_selection" }
      ],
      "mark": { "type": "text", "dx": 8, "dy": -8, "fontSize": 12, "fontStyle": "italic" },
      "encoding": {
        "longitude": { "field": "lon", "type": "quantitative" },
        "latitude":  { "field": "lat", "type": "quantitative" },
        "text": { "field": "Region" },
        "color": { "value": "black" },
        "opacity": {
          "condition": [
            { "test": "Region_selection != null && datum.Region == Region_selection", "value": 1 },
            { "test": "Region_selection == null && (datum.Region == 'Sydney' || datum.Region == 'Melbourne')", "value": 1 }
          ],
          "value": 0
        }
      }
    }
  ],

  "config": {
    "background": "#eaf5ffff",
    "view": { "fill": "#2f7bffc6", "stroke": null },
    "legend": { "orient": "right", "labelFontSize": 13, "titleFontSize": 12 }  }
}
